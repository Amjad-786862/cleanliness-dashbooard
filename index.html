<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Configuration -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AirportClean">
    <meta name="application-name" content="AirportClean">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#2563eb" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1e40af" media="(prefers-color-scheme: dark)">
    <meta name="msapplication-TileColor" content="#2563eb">
    
    <title>Airport Cleanliness</title>
    
    <!-- Inline Manifest (no external file needed) -->
    <link rel="manifest" id="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIkFpcnBvcnQgQ2xlYW5saW5lc3MiLAogICJzaG9ydF9uYW1lIjogIkFpcnBvcnRDbGVhbiIsCiAgImRlc2NyaXB0aW9uIjogIkRhaWx5IEFpcnBvcnQgQ2xlYW5saW5lc3MgSW5zcGVjdGlvbiAmIE1vbml0b3JpbmciLAogICJzdGFydF91cmwiOiAiLi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMyNTYzZWIiLAogICJ0aGVtZV9jb2xvciI6ICIjMjU2M2ViIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUVjQUFBQjRDQVlBQUFBRG8yVFJBQUFBQVhOU1IwSUFyczRjNlFBQUFBUm5RVTFCQUFDeGp3djhZUVVBQUFBSmNFaFpjd0FBRHNNQUFBN0RBY2R2cUdRQUFBQmwwV0ZsYUFBTTdTQUFBSndDR0VtVm1BQUFDQUFBQUlBQklTVVJCVkFBQUFEMGxXRWxwQUFBQUFTVVZPUks1Q1lJST0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFFY0FBQUI0Q0FZQUFBQUNhVFkwQUFBQUFYRlFaVVFBQUE0VUFBQUJJQ0VmRmFIUjBjSE02THk5M2QzY3Vkek11YjNKbkx6SXdNREU2Y0hOd0FBQUFBRWxGVGtTdVFtQ0MiLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0KICBdCn0=">
    
    <!-- Simple icons using emoji as fallback -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úàÔ∏è</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úàÔ∏è</text></svg>">
    
    <style>
        /* Reset and base styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        /* Header */
        .header { 
            background: linear-gradient(90deg, #2563eb 0%, #4f46e5 100%); 
            color: white; 
            padding: 16px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        .header h1 { font-size: 20px; font-weight: bold; margin-bottom: 4px; }
        .header p { font-size: 12px; opacity: 0.9; }
        
        /* Content */
        .content { padding: 16px; }
        
        /* Form Card */
        .card { 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            padding: 16px; 
            margin-bottom: 12px; 
        }
        
        /* Input Groups */
        .input-group { margin-bottom: 12px; }
        .input-group label { 
            display: block; 
            font-size: 14px; 
            font-weight: 500; 
            color: #374151; 
            margin-bottom: 4px; 
        }
        .input-group input, 
        .input-group select, 
        .input-group textarea { 
            width: 100%; 
            padding: 8px 12px; 
            border: 1px solid #d1d5db; 
            border-radius: 8px; 
            font-size: 14px; 
        }
        .input-group input:focus, 
        .input-group select:focus, 
        .input-group textarea:focus { 
            outline: none; 
            border-color: #2563eb; 
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1); 
        }
        
        /* Buttons */
        .btn-group { 
            display: flex; 
            gap: 8px; 
            margin-top: 16px; 
        }
        .btn { 
            flex: 1; 
            padding: 10px 12px; 
            border: none; 
            border-radius: 8px; 
            font-size: 13px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 4px; 
            transition: all 0.2s; 
        }
        .btn:active { transform: scale(0.98); }
        .btn-green { background: #16a34a; color: white; }
        .btn-blue { background: #2563eb; color: white; }
        .btn-red { background: #dc2626; color: white; }
        
        /* Stats Grid */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            margin-bottom: 12px; 
        }
        .stat-card { 
            background: white; 
            border-radius: 8px; 
            padding: 12px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
            text-align: center; 
        }
        .stat-card.excellent { background: #16a34a; color: white; }
        .stat-card.good { background: #2563eb; color: white; }
        .stat-card.fair { background: #eab308; color: white; }
        .stat-card.poor { background: #dc2626; color: white; }
        .stat-card.pending { background: #6b7280; color: white; }
        .stat-card.avg { background: #4f46e5; color: white; }
        .stat-label { font-size: 11px; opacity: 0.9; margin-bottom: 4px; }
        .stat-value { font-size: 24px; font-weight: bold; }
        
        /* Sections */
        .section { 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            margin-bottom: 12px; 
            overflow: hidden; 
        }
        .section-header { 
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%); 
            color: white; 
            padding: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .section-content { padding: 12px; display: none; }
        .section-content.active { display: block; }
        
        /* Location Cards */
        .location-card { 
            background: #f9fafb; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 12px; 
            margin-bottom: 12px; 
        }
        .location-title { 
            font-weight: 600; 
            color: #1f2937; 
            font-size: 14px; 
            margin-bottom: 12px; 
        }
        .grid-2 { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 8px; 
            margin-bottom: 8px; 
        }
        .grid-3 { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 8px; 
            margin-bottom: 8px; 
        }
        
        /* Checkbox Groups */
        .checkbox-group { display: flex; gap: 12px; margin-bottom: 8px; }
        .checkbox-label { display: flex; align-items: center; font-size: 12px; }
        .checkbox-label input { margin-right: 4px; }
        
        /* Status Colors */
        .status-excellent { background: #16a34a; }
        .status-good { background: #2563eb; }
        .status-fair { background: #eab308; }
        .status-poor { background: #dc2626; }
        .status-pending { background: #6b7280; }
        select.status { color: white; font-weight: 600; }
        
        /* Difference Display */
        .diff-positive { background: #dcfce7; color: #166534; }
        .diff-negative { background: #fee2e2; color: #991b1b; }
        .diff-neutral { background: #f3f4f6; color: #6b7280; }
        .diff-display { 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-size: 12px; 
            font-weight: 600; 
            text-align: center; 
        }
        
        /* Print Styles */
        @media print { 
            .no-print { display: none !important; } 
            body { background: white; }
            .card { box-shadow: none; border: 1px solid #ddd; }
        }
        
        /* Icons */
        .icon { 
            width: 16px; 
            height: 16px; 
            stroke: currentColor; 
            stroke-width: 2; 
            fill: none; 
        }
        
        /* Dustbins Section */
        .dustbins-check-group {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }
        .dustbins-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .dustbins-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        .dustbin-criteria {
            background: white;
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 10px;
        }
        .criteria-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .criteria-options {
            display: flex;
            gap: 12px;
        }
        .criteria-option {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }
        .criteria-option input[type="radio"] {
            margin: 0;
        }
        .yes-option { color: #16a34a; }
        .no-option { color: #dc2626; }
        
        /* GitHub Pages Fix */
        .github-fix {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #f8fafc;
            border-top: 1px solid #e5e7eb;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            color: #6b7280;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚úàÔ∏è Airport Cleanliness</h1>
        <p>Daily Inspection & Monitoring</p>
    </div>

    <div class="content">
        <div class="card">
            <div class="input-group">
                <label>üìÖ Date</label>
                <input type="date" id="date" />
            </div>
            <div class="input-group">
                <label>üïê Shift</label>
                <select id="shift">
                    <option value="">Select Shift</option>
                    <option value="morning">Morning (8 AM - 2 PM)</option>
                    <option value="evening">Evening (2 PM - 8 PM)</option>
                    <option value="night">Night (8 PM - 8 AM)</option>
                </select>
            </div>
            <div class="input-group">
                <label>‚è∞ Time</label>
                <input type="time" id="time" />
            </div>
            <div class="input-group">
                <label>üë§ Inspector</label>
                <input type="text" id="inspector" placeholder="Enter inspector name" />
            </div>
            <div class="btn-group no-print">
                <button class="btn btn-green" onclick="exportCSV()">
                    üì• CSV
                </button>
                <button class="btn btn-blue" onclick="window.print()">
                    üñ®Ô∏è Print
                </button>
                <button class="btn btn-red" onclick="resetAll()">
                    üîÑ Reset
                </button>
            </div>
        </div>

        <div class="stats-grid" id="stats">
            <!-- Stats will be populated by JavaScript -->
        </div>

        <div id="sections">
            <!-- Sections will be populated by JavaScript -->
        </div>
    </div>
    
    <div class="github-fix no-print">
        Airport Cleanliness App | Works offline | Data saved locally
    </div>

    <script>
        // ==================== APP DATA ====================
        const areas = [
            { 
                id: 'apron', 
                name: '‚úàÔ∏è Apron Area', 
                locations: [
                    'Apron Area North Side',
                    'Apron Area South Side',
                    'Apron Toilet North Side',
                    'Apron Toilet South Side',
                    'Bridge Stairs Cleanliness'
                ],
                hasDustbins: true
            },
            { 
                id: 'international', 
                name: 'üåç International Arrival Hall', 
                locations: [
                    'Immigration Area (General)',
                    'Immigration Area - Gents Toilet',
                    'Immigration Area - Ladies Toilet',
                    'Intl. Arrival Hall - Gents Toilet',
                    'Intl. Arrival Hall - Ladies Toilet',
                    'Intl. Arrival Hall - Wheelchair Toilet',
                    'Belts Area',
                    'Exit Area Towards Concourse Hall'
                ],
                hasDustbins: true
            },
            { 
                id: 'domestic', 
                name: 'üè† Domestic Arrival Hall', 
                locations: [
                    'Dom. Arrival Hall (General)',
                    'Dom. Arrival Hall - Gents Toilet',
                    'Dom. Arrival Hall - Ladies Toilet',
                    'Dom. Arrival Hall - Wheelchair Toilet',
                    'Belts Area',
                    'Exit Area Towards Concourse Hall'
                ],
                hasDustbins: true
            },
            { 
                id: 'concourse', 
                name: 'üèõÔ∏è Concourse Hall', 
                locations: [
                    'Concourse North Side',
                    'Concourse South Side',
                    'Concourse - Gents Toilet',
                    'Concourse - Ladies Toilet',
                    'Concourse - Wheelchair Toilet',
                    'Concourse - Janitorial Room (North)',
                    'Concourse - Janitorial Room (South)'
                ],
                hasDustbins: true
            },
            { 
                id: 'parking', 
                name: 'üöó Parking & Roads', 
                locations: [
                    'Parking Area North',
                    'Parking Area South',
                    'Parking Area Central',
                    'VVIP Lanes & Driveways',
                    'Parking Entry/Exit Points',
                    'Entry Roads',
                    'Exit Roads',
                    'Cargo Roads',
                    'Mess Road',
                    'Old Car Parking Area'
                ],
                hasDustbins: true
            }
        ];

        let data = {};

        // ==================== INITIALIZATION ====================
        function init() {
            // Load saved data
            const saved = localStorage.getItem('airportCleanlinessData');
            if (saved) {
                data = JSON.parse(saved);
            } else {
                // Initialize with default data
                areas.forEach(area => {
                    area.locations.forEach(loc => {
                        const key = `${area.id}-${loc.replace(/\s+/g, '-')}`;
                        data[key] = { 
                            status: 'pending', 
                            score: '', 
                            deepClean: false, 
                            routineClean: false, 
                            manpower: '', 
                            material: '', 
                            statedStaff: '', 
                            actualStaff: '', 
                            notes: ''
                        };
                    });
                    
                    // Initialize dustbins data
                    if (area.hasDustbins) {
                        const dustbinsKey = `${area.id}-dustbins`;
                        data[dustbinsKey] = { 
                            fullOfGarbage: 'pending',
                            cleaned: 'pending',
                            emptiedTimely: 'pending',
                            lastEmptied: '',
                            notes: ''
                        };
                    }
                });
            }

            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = localStorage.getItem('inspectionDate') || today;
            document.getElementById('shift').value = localStorage.getItem('inspectionShift') || '';
            document.getElementById('time').value = localStorage.getItem('inspectionTime') || '';
            document.getElementById('inspector').value = localStorage.getItem('inspectionInspector') || '';

            // Render everything
            renderSections();
            updateStats();

            // Auto-save form data
            document.getElementById('date').addEventListener('change', e => {
                localStorage.setItem('inspectionDate', e.target.value);
            });
            document.getElementById('shift').addEventListener('change', e => {
                localStorage.setItem('inspectionShift', e.target.value);
            });
            document.getElementById('time').addEventListener('change', e => {
                localStorage.setItem('inspectionTime', e.target.value);
            });
            document.getElementById('inspector').addEventListener('input', e => {
                localStorage.setItem('inspectionInspector', e.target.value);
            });
            
            // GitHub Pages fix - ensure content loads
            setTimeout(() => {
                if (document.getElementById('sections').innerHTML === '') {
                    renderSections();
                }
            }, 100);
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderSections() {
            const container = document.getElementById('sections');
            container.innerHTML = areas.map(area => `
                <div class="section">
                    <div class="section-header" onclick="toggleSection('${area.id}')">
                        <span>${area.name}</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="section-content" id="content-${area.id}">
                        ${renderAreaContent(area)}
                    </div>
                </div>
            `).join('');
        }

        function renderAreaContent(area) {
            let content = '';
            
            // Add dustbins section if applicable
            if (area.hasDustbins) {
                const dustbinsKey = `${area.id}-dustbins`;
                const dustbinsData = data[dustbinsKey] || {};
                content += `
                    <div class="dustbins-check-group">
                        <div class="dustbins-title">
                            üóëÔ∏è Dustbins Inspection
                        </div>
                        <div class="dustbins-grid">
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üì¶ Full of Garbage?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-full" value="yes" 
                                            ${dustbinsData.fullOfGarbage === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'fullOfGarbage', 'yes')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-full" value="no" 
                                            ${dustbinsData.fullOfGarbage === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'fullOfGarbage', 'no')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-full" value="pending" 
                                            ${dustbinsData.fullOfGarbage === 'pending' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'fullOfGarbage', 'pending')">
                                        <span>‚è±Ô∏è Pending</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üßπ Properly Cleaned?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-cleaned" value="yes" 
                                            ${dustbinsData.cleaned === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'cleaned', 'yes')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-cleaned" value="no" 
                                            ${dustbinsData.cleaned === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'cleaned', 'no')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-cleaned" value="pending" 
                                            ${dustbinsData.cleaned === 'pending' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'cleaned', 'pending')">
                                        <span>‚è±Ô∏è Pending</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    ‚è∞ Emptied Timely?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-emptied" value="yes" 
                                            ${dustbinsData.emptiedTimely === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'emptiedTimely', 'yes')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-emptied" value="no" 
                                            ${dustbinsData.emptiedTimely === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'emptiedTimely', 'no')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-emptied" value="pending" 
                                            ${dustbinsData.emptiedTimely === 'pending' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'emptiedTimely', 'pending')">
                                        <span>‚è±Ô∏è Pending</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üìÖ Last Emptied
                                </div>
                                <input type="datetime-local" 
                                    value="${dustbinsData.lastEmptied || ''}"
                                    onchange="updateDustbinsLastEmptied('${area.id}', this.value)"
                                    style="width: 100%; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                            </div>
                        </div>
                        
                        <div class="input-group" style="margin-top: 8px;">
                            <label>üìù Dustbins Notes</label>
                            <textarea rows="2" placeholder="Additional notes about dustbins..."
                                onchange="updateDustbinsNotes('${area.id}', this.value)"
                                style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">${dustbinsData.notes || ''}</textarea>
                        </div>
                    </div>
                `;
            }
            
            // Add regular location cards
            content += area.locations.map(loc => renderLocation(area.id, loc)).join('');
            
            return content;
        }

        function renderLocation(areaId, location) {
            const key = `${areaId}-${location.replace(/\s+/g, '-')}`;
            const d = data[key] || {};
            const diff = d.actualStaff && d.statedStaff ? parseInt(d.actualStaff) - parseInt(d.statedStaff) : '';
            const diffClass = diff < 0 ? 'diff-negative' : diff > 0 ? 'diff-positive' : 'diff-neutral';

            return `
                <div class="location-card">
                    <div class="location-title">${location}</div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Status</label>
                            <select class="status status-${d.status}" onchange="updateData('${key}', 'status', this.value)">
                                <option value="pending" ${d.status === 'pending' ? 'selected' : ''}>‚è±Ô∏è Pending</option>
                                <option value="excellent" ${d.status === 'excellent' ? 'selected' : ''}>‚úÖ Excellent</option>
                                <option value="good" ${d.status === 'good' ? 'selected' : ''}>üëç Good</option>
                                <option value="fair" ${d.status === 'fair' ? 'selected' : ''}>‚ö†Ô∏è Fair</option>
                                <option value="poor" ${d.status === 'poor' ? 'selected' : ''}>‚ùå Poor</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Score (%)</label>
                            <input type="number" value="${d.score || ''}" min="0" max="100" placeholder="0-100" 
                                onchange="updateData('${key}', 'score', this.value)" />
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" ${d.deepClean ? 'checked' : ''} 
                                onchange="updateData('${key}', 'deepClean', this.checked)" />
                            Deep Clean
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" ${d.routineClean ? 'checked' : ''} 
                                onchange="updateData('${key}', 'routineClean', this.checked)" />
                            Routine Clean
                        </label>
                    </div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Manpower</label>
                            <input type="text" value="${d.manpower || ''}" 
                                onchange="updateData('${key}', 'manpower', this.value)" />
                        </div>
                        <div class="input-group">
                            <label>Material</label>
                            <input type="text" value="${d.material || ''}" 
                                onchange="updateData('${key}', 'material', this.value)" />
                        </div>
                    </div>
                    <div class="grid-3">
                        <div class="input-group">
                            <label>Stated Staff</label>
                            <input type="number" value="${d.statedStaff || ''}" 
                                onchange="updateData('${key}', 'statedStaff', this.value)" />
                        </div>
                        <div class="input-group">
                            <label>Actual Staff</label>
                            <input type="number" value="${d.actualStaff || ''}" 
                                onchange="updateData('${key}', 'actualStaff', this.value)" />
                        </div>
                        <div class="input-group">
                            <label>Difference</label>
                            <div class="diff-display ${diffClass}">
                                ${diff !== '' ? (diff > 0 ? '+' + diff : diff) : '-'}
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Notes</label>
                        <textarea rows="2" placeholder="Add notes..." 
                            onchange="updateData('${key}', 'notes', this.value)">${d.notes || ''}</textarea>
                    </div>
                </div>
            `;
        }

        // ==================== DATA MANAGEMENT ====================
        function updateData(key, field, value) {
            if (!data[key]) data[key] = {};
            data[key][field] = value;
            localStorage.setItem('airportCleanlinessData', JSON.stringify(data));
            updateStats();
        }

        function updateDustbins(areaId, field, value) {
            const key = `${areaId}-dustbins`;
            updateData(key, field, value);
        }

        function updateDustbinsLastEmptied(areaId, value) {
            const key = `${areaId}-dustbins`;
            updateData(key, 'lastEmptied', value);
        }

        function updateDustbinsNotes(areaId, value) {
            const key = `${areaId}-dustbins`;
            updateData(key, 'notes', value);
        }

        // ==================== UI FUNCTIONS ====================
        function toggleSection(id) {
            const content = document.getElementById(`content-${id}`);
            const isActive = content.classList.contains('active');
            
            // Close all other sections
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // Toggle current section
            if (!isActive) {
                content.classList.add('active');
            }
        }

        function updateStats() {
            const values = Object.values(data);
            const stats = {
                excellent: values.filter(v => v.status === 'excellent').length,
                good: values.filter(v => v.status === 'good').length,
                fair: values.filter(v => v.status === 'fair').length,
                poor: values.filter(v => v.status === 'poor').length,
                pending: values.filter(v => v.status === 'pending').length
            };
            
            const scores = values.filter(v => v.score !== '' && v.score !== undefined).map(v => parseInt(v.score) || 0);
            const avgScore = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
            
            // Dustbin stats
            const dustbinData = Object.entries(data).filter(([key]) => key.includes('dustbins'));
            const dustbinStats = {
                fullYes: dustbinData.filter(([_, v]) => v.fullOfGarbage === 'yes').length,
                cleanedYes: dustbinData.filter(([_, v]) => v.cleaned === 'yes').length,
                emptiedYes: dustbinData.filter(([_, v]) => v.emptiedTimely === 'yes').length
            };

            const statsContainer = document.getElementById('stats');
            statsContainer.innerHTML = `
                <div class="stat-card excellent">
                    <div class="stat-label">Excellent</div>
                    <div class="stat-value">${stats.excellent}</div>
                </div>
                <div class="stat-card good">
                    <div class="stat-label">Good</div>
                    <div class="stat-value">${stats.good}</div>
                </div>
                <div class="stat-card fair">
                    <div class="stat-label">Fair</div>
                    <div class="stat-value">${stats.fair}</div>
                </div>
                <div class="stat-card poor">
                    <div class="stat-label">Poor</div>
                    <div class="stat-value">${stats.poor}</div>
                </div>
                <div class="stat-card pending">
                    <div class="stat-label">Pending</div>
                    <div class="stat-value">${stats.pending}</div>
                </div>
                <div class="stat-card avg">
                    <div class="stat-label">Avg Score</div>
                    <div class="stat-value">${avgScore}%</div>
                </div>
                <div class="stat-card ${dustbinStats.fullYes === 0 ? 'good' : 'poor'}">
                    <div class="stat-label">Dustbins Full</div>
                    <div class="stat-value">${dustbinStats.fullYes}</div>
                </div>
                <div class="stat-card ${dustbinStats.cleanedYes === areas.filter(a => a.hasDustbins).length ? 'good' : 'fair'}">
                    <div class="stat-label">Dustbins Clean</div>
                    <div class="stat-value">${dustbinStats.cleanedYes}</div>
                </div>
                <div class="stat-card ${dustbinStats.emptiedYes === areas.filter(a => a.hasDustbins).length ? 'good' : 'fair'}">
                    <div class="stat-label">Emptied Timely</div>
                    <div class="stat-value">${dustbinStats.emptiedYes}</div>
                </div>
            `;
        }

        // ==================== EXPORT FUNCTIONS ====================
        function exportCSV() {
            let csv = 'Date,Shift,Time,Inspector,Area,Location,Status,Score,Deep Clean,Routine Clean,Manpower,Material,Stated Staff,Actual Staff,Difference,Notes\n';
            const date = document.getElementById('date').value;
            const shift = document.getElementById('shift').value;
            const time = document.getElementById('time').value;
            const inspector = document.getElementById('inspector').value;

            areas.forEach(area => {
                // Export locations
                area.locations.forEach(loc => {
                    const key = `${area.id}-${loc.replace(/\s+/g, '-')}`;
                    const d = data[key] || {};
                    const diff = d.actualStaff && d.statedStaff ? parseInt(d.actualStaff) - parseInt(d.statedStaff) : '';
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","${loc}","${d.status || ''}","${d.score || ''}","${d.deepClean || false}","${d.routineClean || false}","${d.manpower || ''}","${d.material || ''}","${d.statedStaff || ''}","${d.actualStaff || ''}","${diff}","${d.notes || ''}"\n`;
                });
                
                // Export dustbins data
                if (area.hasDustbins) {
                    const dustbinsKey = `${area.id}-dustbins`;
                    const dustbinsData = data[dustbinsKey] || {};
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","Dustbins","","","","","","","","","","Full: ${dustbinsData.fullOfGarbage || ''}, Cleaned: ${dustbinsData.cleaned || ''}, Emptied: ${dustbinsData.emptiedTimely || ''}, Last: ${dustbinsData.lastEmptied || ''}, Notes: ${dustbinsData.notes || ''}"\n`;
                }
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `airport-cleanliness-${date}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function resetAll() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // ==================== INITIALIZE APP ====================
        // Wait for DOM to be fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
        // GitHub Pages specific fix
        window.addEventListener('load', function() {
            // Force re-render if sections are empty
            if (document.getElementById('sections').innerHTML.trim() === '') {
                setTimeout(init, 500);
            }
        });
    </script>
</body>
</html>