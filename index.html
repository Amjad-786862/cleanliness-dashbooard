<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Configuration -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AirportClean">
    <meta name="application-name" content="AirportClean">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#2563eb" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1e40af" media="(prefers-color-scheme: dark)">
    <meta name="msapplication-TileColor" content="#2563eb">
    
    <title>Airport Cleanliness</title>
    
    <!-- Inline Manifest -->
    <link rel="manifest" id="manifest">
    
    <!-- Simple icon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úàÔ∏è</text></svg>">
    
    <style>
        /* Reset and base styles */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding-bottom: 20px;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Header */
        .header { 
            background: linear-gradient(90deg, #2563eb 0%, #4f46e5 100%); 
            color: white; 
            padding: 16px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        .header h1 { 
            font-size: clamp(18px, 5vw, 22px); 
            font-weight: bold; 
            margin-bottom: 4px; 
        }
        .header p { 
            font-size: 12px; 
            opacity: 0.9; 
        }
        
        /* Content */
        .content { 
            padding: 12px; 
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* Form Card */
        .card { 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            padding: 16px; 
            margin-bottom: 12px;
            width: 100%;
            overflow: hidden;
        }
        
        /* Input Groups */
        .input-group { 
            margin-bottom: 12px; 
            width: 100%;
        }
        .input-group label { 
            display: block; 
            font-size: 14px; 
            font-weight: 500; 
            color: #374151; 
            margin-bottom: 6px; 
        }
        .input-group input, 
        .input-group select, 
        .input-group textarea { 
            width: 100%; 
            padding: 10px 12px; 
            border: 1px solid #d1d5db; 
            border-radius: 8px; 
            font-size: 15px; 
            -webkit-appearance: none;
        }
        .input-group input:focus, 
        .input-group select:focus, 
        .input-group textarea:focus { 
            outline: none; 
            border-color: #2563eb; 
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1); 
        }
        
        /* Buttons */
        .btn-group { 
            display: flex; 
            flex-wrap: wrap;
            gap: 8px; 
            margin-top: 16px; 
            width: 100%;
        }
        .btn { 
            flex: 1 1 calc(50% - 8px);
            min-width: 0;
            padding: 12px; 
            border: none; 
            border-radius: 8px; 
            font-size: 14px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 6px; 
            transition: all 0.2s; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .btn:active { transform: scale(0.98); }
        .btn-green { background: #16a34a; color: white; }
        .btn-blue { background: #2563eb; color: white; }
        .btn-red { background: #dc2626; color: white; }
        
        /* Stats Grid */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 8px; 
            margin-bottom: 12px; 
        }
        @media (min-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .stat-card { 
            background: white; 
            border-radius: 8px; 
            padding: 12px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            text-align: center; 
            min-width: 0;
        }
        .stat-card.excellent { background: #16a34a; color: white; }
        .stat-card.good { background: #2563eb; color: white; }
        .stat-card.fair { background: #eab308; color: white; }
        .stat-card.poor { background: #dc2626; color: white; }
        .stat-card.pending { background: #6b7280; color: white; }
        .stat-card.avg { background: #4f46e5; color: white; }
        .stat-card.walls-clean { background: #10b981; color: white; }
        .stat-card.web-clean { background: #8b5cf6; color: white; }
        .stat-card.fia-excellent { background: #059669; color: white; }
        .stat-card.belt-good { background: #3b82f6; color: white; }
        .stat-label { 
            font-size: 11px; 
            opacity: 0.9; 
            margin-bottom: 4px; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .stat-value { 
            font-size: 20px; 
            font-weight: bold; 
            line-height: 1.2;
        }
        
        /* Sections */
        .section { 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            margin-bottom: 12px; 
            overflow: hidden; 
            width: 100%;
        }
        .section-header { 
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%); 
            color: white; 
            padding: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-size: 15px;
        }
        .section-content { 
            padding: 12px; 
            display: none; 
            width: 100%;
            overflow: hidden;
        }
        .section-content.active { display: block; }
        
        /* Location Cards */
        .location-card { 
            background: #f9fafb; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 12px; 
            margin-bottom: 12px; 
            width: 100%;
            overflow: hidden;
        }
        .location-title { 
            font-weight: 600; 
            color: #1f2937; 
            font-size: 14px; 
            margin-bottom: 12px; 
            line-height: 1.4;
        }
        
        /* Grids - Responsive */
        .grid-2 { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 8px; 
            margin-bottom: 8px; 
            width: 100%;
        }
        .grid-3 { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px; 
            margin-bottom: 8px; 
            width: 100%;
        }
        
        /* Checkbox Groups */
        .checkbox-group { 
            display: flex; 
            flex-wrap: wrap;
            gap: 12px; 
            margin-bottom: 12px; 
            width: 100%;
        }
        .checkbox-label { 
            display: flex; 
            align-items: center; 
            font-size: 13px; 
            flex: 1 1 auto;
            min-width: 120px;
        }
        .checkbox-label input { 
            margin-right: 6px; 
            min-width: 18px;
            height: 18px;
        }
        
        /* Status Colors */
        select.status { 
            color: white; 
            font-weight: 600; 
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: none;
            font-size: 14px;
        }
        .status-excellent { background: #16a34a; }
        .status-good { background: #2563eb; }
        .status-fair { background: #eab308; }
        .status-poor { background: #dc2626; }
        .status-pending { background: #6b7280; }
        .status-clean { background: #10b981; }
        .status-dirty { background: #dc2626; }
        .status-completed { background: #10b981; }
        .status-in-progress { background: #f59e0b; }
        .status-not-started { background: #6b7280; }
        
        /* Difference Display */
        .diff-positive { background: #dcfce7; color: #166534; }
        .diff-negative { background: #fee2e2; color: #991b1b; }
        .diff-neutral { background: #f3f4f6; color: #6b7280; }
        .diff-display { 
            padding: 8px 4px; 
            border-radius: 6px; 
            font-size: 13px; 
            font-weight: 600; 
            text-align: center; 
            min-width: 0;
            overflow: hidden;
        }
        
        /* Time Checked Styles */
        .time-checked-container {
            margin-top: 8px;
            font-size: 12px;
            color: #666;
            background: #f8f9fa;
            padding: 6px 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            border-left: 3px solid #2563eb;
            width: fit-content;
        }
        .time-checked-label {
            font-weight: 500;
            color: #374151;
        }
        .time-checked-value {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #2563eb;
        }
        
        /* Print Styles */
        @media print { 
            .no-print { display: none !important; } 
            body { background: white; }
            .card { box-shadow: none; border: 1px solid #ddd; }
        }
        
        /* ==================== SPECIAL SECTIONS ==================== */
        
        /* Walls Check Section */
        .walls-check-group {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        .walls-title {
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
        }
        .walls-options {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            width: 100%;
        }
        .wall-option {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            flex: 1;
            min-width: 100px;
        }
        .wall-option input[type="radio"] {
            margin: 0;
            min-width: 20px;
            height: 20px;
        }
        .wall-tick { 
            color: #10b981; 
            font-weight: bold;
            font-size: 13px;
        }
        .wall-cross { 
            color: #dc2626; 
            font-weight: bold;
            font-size: 13px;
        }
        
        /* Web Clean Section */
        .web-clean-group {
            background: #faf5ff;
            border: 1px solid #8b5cf6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        .web-clean-title {
            font-weight: 600;
            color: #7c3aed;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
        }
        
        /* FIA Counter Section */
        .fia-counter-group {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        .fia-counter-title {
            font-weight: 600;
            color: #15803d;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
        }
        
        /* Conveyor Belt Section */
        .conveyor-belt-group {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        .conveyor-belt-title {
            font-weight: 600;
            color: #1d4ed8;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
        }
        
        /* Level 0 Big Section */
        .level0-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 12px;
        }
        @media (min-width: 640px) {
            .level0-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        .level0-subsection {
            background: #f8fafc;
            border: 2px solid #cbd5e1;
            border-radius: 10px;
            padding: 12px;
        }
        .subsection-title {
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 10px;
            font-size: 14px;
            padding-bottom: 6px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        /* Dustbins Section */
        .dustbins-check-group {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        .dustbins-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
        }
        .dustbins-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 12px;
            width: 100%;
        }
        @media (min-width: 480px) {
            .dustbins-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
        }
        .dustbin-criteria {
            background: white;
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 10px;
            min-width: 0;
            overflow: hidden;
            box-sizing: border-box;
        }
        .criteria-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .criteria-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            width: 100%;
        }
        .criteria-option {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            flex: 1;
            min-width: 60px;
        }
        .criteria-option input[type="radio"] {
            margin: 0;
            min-width: 18px;
            height: 18px;
        }
        .yes-option { 
            color: #16a34a; 
            font-size: 12px;
            white-space: nowrap;
        }
        .no-option { 
            color: #dc2626; 
            font-size: 12px;
            white-space: nowrap;
        }
        
        /* Date inputs */
        .dustbin-criteria input[type="datetime-local"],
        .web-clean-group input[type="date"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        /* Textareas */
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            min-height: 60px;
            resize: vertical;
            margin-top: 4px;
        }
        
        /* Footer */
        .github-fix {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #f8fafc;
            border-top: 1px solid #e5e7eb;
            padding: 10px;
            text-align: center;
            font-size: 11px;
            color: #6b7280;
            z-index: 999;
        }
        
        /* Mobile optimizations */
        @media (max-width: 360px) {
            .btn {
                font-size: 12px;
                padding: 10px 6px;
            }
            .stat-value {
                font-size: 18px;
            }
            .grid-3 {
                grid-template-columns: 1fr 1fr;
            }
            .walls-options,
            .criteria-options {
                gap: 8px;
            }
        }
        
        /* Ensure no horizontal scrolling */
        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* Touch-friendly sizes */
        input, select, textarea, button {
            font-size: 16px !important;
            min-height: 44px;
        }
        
        .checkbox-label input[type="checkbox"],
        input[type="radio"],
        .wall-option input[type="radio"] {
            min-height: 20px;
            min-width: 20px;
        }
    </style>
    
    <script>
        // Set manifest dynamically
        document.addEventListener('DOMContentLoaded', function() {
            const manifest = {
                "name": "Airport Cleanliness",
                "short_name": "AirportClean",
                "description": "Daily Airport Cleanliness Inspection",
                "start_url": "./",
                "display": "standalone",
                "background_color": "#2563eb",
                "theme_color": "#2563eb",
                "orientation": "portrait",
                "icons": []
            };
            
            const blob = new Blob([JSON.stringify(manifest)], {type: 'application/manifest+json'});
            const url = URL.createObjectURL(blob);
            document.getElementById('manifest').href = url;
        });
    </script>
</head>
<body>
    <div class="header">
        <h1>‚úàÔ∏è Airport Cleanliness</h1>
        <p>Daily Inspection & Monitoring</p>
    </div>

    <div class="content">
        <div class="card">
            <div class="input-group">
                <label>üìÖ Date</label>
                <input type="date" id="date" />
            </div>
            <div class="input-group">
                <label>üïê Shift</label>
                <select id="shift">
                    <option value="">Select Shift</option>
                    <option value="morning">Morning (8 AM - 2 PM)</option>
                    <option value="evening">Evening (2 PM - 8 PM)</option>
                    <option value="night">Night (8 PM - 8 AM)</option>
                </select>
            </div>
            <div class="input-group">
                <label>‚è∞ Time</label>
                <input type="time" id="time" />
            </div>
            <div class="input-group">
                <label>üë§ Inspector</label>
                <input type="text" id="inspector" placeholder="Enter inspector name" />
            </div>
            <div class="btn-group no-print">
                <button class="btn btn-green" onclick="exportCSV()">
                    üì• CSV
                </button>
                <button class="btn btn-blue" onclick="window.print()">
                    üñ®Ô∏è Print
                </button>
                <button class="btn btn-red" onclick="resetAll()">
                    üîÑ Reset
                </button>
            </div>
        </div>

        <div class="stats-grid" id="stats">
            <!-- Stats will be populated -->
        </div>

        <div id="sections">
            <!-- Sections will be populated -->
        </div>
    </div>
    
    <div class="github-fix no-print">
        Airport Cleanliness App | Works offline | Data saved locally
    </div>

    <script>
        // ==================== APP DATA ====================
        const areas = [
            { 
                id: 'apron', 
                name: '‚úàÔ∏è Apron Area', 
                locations: [
                    'Apron Area North Side',
                    'Apron Area South Side',
                    'Apron Toilet North Side',
                    'Apron Toilet South Side',
                    'Bridge Stairs Cleanliness'
                ],
                hasDustbins: true,
                hasWalls: true,
                hasToilets: true
            },
            { 
                id: 'international', 
                name: 'üåç International Arrival', 
                locations: [
                    'Immigration Area',
                    'Intl. Arrival Hall',
                    'Gents Toilet',
                    'Ladies Toilet',
                    'Wheelchair Toilet',
                    'Belts Area'
                ],
                hasDustbins: true,
                hasWalls: true,
                hasToilets: true,
                hasFIACounters: true,
                hasConveyorBelt: true
            },
            { 
                id: 'domestic', 
                name: 'üè† Domestic Arrival', 
                locations: [
                    'Dom. Arrival Hall',
                    'Gents Toilet',
                    'Ladies Toilet',
                    'Wheelchair Toilet',
                    'Belts Area'
                ],
                hasDustbins: true,
                hasWalls: true,
                hasToilets: true,
                hasConveyorBelt: true
            },
            { 
                id: 'concourse', 
                name: 'üèõÔ∏è Concourse Hall', 
                locations: [
                    'Concourse North Side',
                    'Concourse South Side',
                    'Gents Toilet',
                    'Ladies Toilet',
                    'Wheelchair Toilet'
                ],
                hasDustbins: true,
                hasWalls: true,
                hasToilets: true
            },
            { 
                id: 'parking', 
                name: 'üöó Parking & Roads', 
                locations: [
                    'Parking Area North',
                    'Parking Area South',
                    'Parking Central',
                    'Entry/Exit Points'
                ],
                hasDustbins: true
            },
            { 
                id: 'level0', 
                name: 'üè¢ Level 0 - Complete Area', 
                locations: [
                    'Concourse Hall Level 0 (General)',
                    'Concourse Hall - Gents Toilet',
                    'Concourse Hall - Ladies Toilet',
                    'Concourse Hall - Wheelchair Toilet',
                    'Web Cleaning North Section',
                    'Web Cleaning South Section',
                    'Staircases Level 0',
                    'Corridors & Passageways'
                ],
                hasDustbins: true,
                hasWalls: true,
                hasToilets: true,
                hasWebClean: true,
                isLevel0: true
            }
        ];

        let data = {};

        // ==================== TIME CHECKED FUNCTIONS ====================
        function getCurrentTimeChecked() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        }

        function getCurrentDateChecked() {
            const now = new Date();
            return now.toLocaleDateString('en-GB');
        }

        function addTimeChecked(elementId, label) {
            const section = document.getElementById(elementId);
            if (!section) return;
            
            // Remove existing time checked if any
            const existingTime = section.querySelector('.time-checked-container');
            if (existingTime) {
                existingTime.remove();
            }
            
            // Create new time checked element
            const timeDiv = document.createElement('div');
            timeDiv.className = 'time-checked-container';
            const date = getCurrentDateChecked();
            const time = getCurrentTimeChecked();
            timeDiv.innerHTML = `
                <span class="time-checked-label">‚è∞ Time Checked:</span>
                <span class="time-checked-value">${date} ${time}</span>
            `;
            
            // Append to the section
            section.appendChild(timeDiv);
            
            // Save time checked to data
            const areaId = elementId.split('-')[0];
            const location = label.replace(/\s+/g, '_');
            const key = `${areaId}-${location}`;
            if (!data[key]) data[key] = {};
            data[key].timeChecked = `${date} ${time}`;
            localStorage.setItem('airportCleanlinessData', JSON.stringify(data));
        }

        function updateDataWithTimeChecked(key, field, value, elementId, label) {
            updateData(key, field, value);
            addTimeChecked(elementId, label);
        }

        // ==================== INITIALIZATION ====================
        function init() {
            // Load saved data
            const saved = localStorage.getItem('airportCleanlinessData');
            if (saved) {
                try {
                    data = JSON.parse(saved);
                } catch (e) {
                    data = {};
                }
            }
            
            // Initialize with default data if needed
            areas.forEach(area => {
                area.locations.forEach(loc => {
                    const key = `${area.id}-${loc.replace(/\s+/g, '_')}`;
                    if (!data[key]) {
                        data[key] = { 
                            status: 'pending', 
                            score: '', 
                            deepClean: false, 
                            routineClean: false, 
                            manpower: '', 
                            material: '', 
                            statedStaff: '', 
                            actualStaff: '', 
                            notes: '',
                            timeChecked: ''
                        };
                    }
                });
                
                // Initialize dustbins data
                if (area.hasDustbins) {
                    const dustbinsKey = `${area.id}-dustbins`;
                    if (!data[dustbinsKey]) {
                        data[dustbinsKey] = { 
                            fullOfGarbage: 'pending',
                            cleaned: 'pending',
                            emptiedTimely: 'pending',
                            lastEmptied: '',
                            notes: '',
                            timeChecked: ''
                        };
                    }
                }
                
                // Initialize walls data
                if (area.hasWalls) {
                    const wallsKey = `${area.id}-walls`;
                    if (!data[wallsKey]) {
                        data[wallsKey] = { 
                            wallsStatus: 'pending',
                            notes: '',
                            timeChecked: ''
                        };
                    }
                }
                
                // Initialize FIA counters data
                if (area.hasFIACounters) {
                    const fiaKey = `${area.id}-fia-counters`;
                    if (!data[fiaKey]) {
                        data[fiaKey] = { 
                            status: 'pending',
                            notes: '',
                            timeChecked: ''
                        };
                    }
                }
                
                // Initialize conveyor belt data
                if (area.hasConveyorBelt) {
                    const beltKey = `${area.id}-conveyor-belt`;
                    if (!data[beltKey]) {
                        data[beltKey] = { 
                            status: 'pending',
                            lastCleaned: '',
                            notes: '',
                            timeChecked: ''
                        };
                    }
                }
                
                // Initialize web clean data
                if (area.hasWebClean) {
                    const webKey = `${area.id}-web-clean`;
                    if (!data[webKey]) {
                        data[webKey] = { 
                            status: 'pending',
                            lastCleaned: '',
                            notes: '',
                            timeChecked: ''
                        };
                    }
                }
                
                // Initialize toilet walls data
                if (area.hasToilets) {
                    const toiletWallsKey = `${area.id}-toilet-walls`;
                    if (!data[toiletWallsKey]) {
                        data[toiletWallsKey] = { 
                            status: 'pending',
                            timeChecked: ''
                        };
                    }
                }
            });

            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            const dateEl = document.getElementById('date');
            if (dateEl) dateEl.value = localStorage.getItem('inspectionDate') || today;
            
            // Load other form data
            const shiftEl = document.getElementById('shift');
            const timeEl = document.getElementById('time');
            const inspectorEl = document.getElementById('inspector');
            
            if (shiftEl) shiftEl.value = localStorage.getItem('inspectionShift') || '';
            if (timeEl) timeEl.value = localStorage.getItem('inspectionTime') || '';
            if (inspectorEl) inspectorEl.value = localStorage.getItem('inspectionInspector') || '';

            // Render everything
            renderSections();
            updateStats();

            // Auto-save form data
            if (dateEl) dateEl.addEventListener('change', e => {
                localStorage.setItem('inspectionDate', e.target.value);
            });
            if (shiftEl) shiftEl.addEventListener('change', e => {
                localStorage.setItem('inspectionShift', e.target.value);
            });
            if (timeEl) timeEl.addEventListener('change', e => {
                localStorage.setItem('inspectionTime', e.target.value);
            });
            if (inspectorEl) inspectorEl.addEventListener('input', e => {
                localStorage.setItem('inspectionInspector', e.target.value);
            });
            
            // Ensure mobile viewport works
            document.body.style.width = '100%';
            document.body.style.overflowX = 'hidden';
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderSections() {
            const container = document.getElementById('sections');
            if (!container) return;
            
            container.innerHTML = areas.map(area => `
                <div class="section">
                    <div class="section-header" onclick="toggleSection('${area.id}')">
                        <span>${area.name}</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="section-content" id="content-${area.id}">
                        ${renderAreaContent(area)}
                    </div>
                </div>
            `).join('');
        }

        function renderAreaContent(area) {
            let content = '';
            
            // a) Add Walls Section (Tick and Cross bullets)
            if (area.hasWalls) {
                const wallsKey = `${area.id}-walls`;
                const wallsData = data[wallsKey] || {};
                const wallsElementId = `${area.id}-walls-section`;
                content += `
                    <div class="walls-check-group" id="${wallsElementId}">
                        <div class="walls-title">
                            üß± Walls Condition
                        </div>
                        <div class="walls-options">
                            <label class="wall-option">
                                <input type="radio" name="${wallsKey}" value="clean" 
                                    ${wallsData.wallsStatus === 'clean' ? 'checked' : ''}
                                    onchange="updateWallsStatus('${area.id}', 'clean', '${wallsElementId}', 'Walls Condition')">
                                <span class="wall-tick">‚úÖ Clean</span>
                            </label>
                            <label class="wall-option">
                                <input type="radio" name="${wallsKey}" value="dirty" 
                                    ${wallsData.wallsStatus === 'dirty' ? 'checked' : ''}
                                    onchange="updateWallsStatus('${area.id}', 'dirty', '${wallsElementId}', 'Walls Condition')">
                                <span class="wall-cross">‚ùå Dirty</span>
                            </label>
                        </div>
                        <div style="margin-top: 8px;">
                            <textarea placeholder="Walls condition notes..."
                                onchange="updateWallsNotes('${area.id}', this.value, '${wallsElementId}', 'Walls Condition')">${wallsData.notes || ''}</textarea>
                        </div>
                        ${wallsData.timeChecked ? `
                            <div class="time-checked-container">
                                <span class="time-checked-label">‚è∞ Time Checked:</span>
                                <span class="time-checked-value">${wallsData.timeChecked}</span>
                            </div>
                        ` : '<div class="time-checked-container"><span class="time-checked-label">‚è∞ Time Checked:</span><span class="time-checked-value">Not yet checked</span></div>'}
                    </div>
                `;
            }
            
            // Add toilets walls check if area has toilets
            if (area.hasToilets && area.id !== 'level0') {
                const toiletWallsElementId = `${area.id}-toilet-walls-section`;
                const toiletWallsData = data[`${area.id}-toilet-walls`] || {};
                content += `
                    <div class="walls-check-group" id="${toiletWallsElementId}">
                        <div class="walls-title">
                            üöΩ Toilet Walls Condition
                        </div>
                        <div class="walls-options">
                            <label class="wall-option">
                                <input type="radio" name="${area.id}-toilet-walls" value="clean" 
                                    ${toiletWallsData.status === 'clean' ? 'checked' : ''}
                                    onchange="updateToiletWalls('${area.id}', 'clean', '${toiletWallsElementId}', 'Toilet Walls')">
                                <span class="wall-tick">‚úÖ Clean</span>
                            </label>
                            <label class="wall-option">
                                <input type="radio" name="${area.id}-toilet-walls" value="dirty" 
                                    ${toiletWallsData.status === 'dirty' ? 'checked' : ''}
                                    onchange="updateToiletWalls('${area.id}', 'dirty', '${toiletWallsElementId}', 'Toilet Walls')">
                                <span class="wall-cross">‚ùå Dirty</span>
                            </label>
                        </div>
                        ${toiletWallsData.timeChecked ? `
                            <div class="time-checked-container">
                                <span class="time-checked-label">‚è∞ Time Checked:</span>
                                <span class="time-checked-value">${toiletWallsData.timeChecked}</span>
                            </div>
                        ` : '<div class="time-checked-container"><span class="time-checked-label">‚è∞ Time Checked:</span><span class="time-checked-value">Not yet checked</span></div>'}
                    </div>
                `;
            }
            
            // c) Add Immigration FIA Counter Section
            if (area.hasFIACounters) {
                const fiaKey = `${area.id}-fia-counters`;
                const fiaData = data[fiaKey] || {};
                const fiaElementId = `${area.id}-fia-section`;
                content += `
                    <div class="fia-counter-group" id="${fiaElementId}">
                        <div class="fia-counter-title">
                            üõÇ Immigration FIA Counters
                        </div>
                        <div class="grid-2">
                            <div class="input-group">
                                <label>Status</label>
                                <select class="status status-${fiaData.status || 'pending'}" 
                                    onchange="updateFIAStatus('${area.id}', this.value, '${fiaElementId}', 'FIA Counters')">
                                    <option value="pending" ${fiaData.status === 'pending' ? 'selected' : ''}>‚è±Ô∏è Pending</option>
                                    <option value="excellent" ${fiaData.status === 'excellent' ? 'selected' : ''}>‚úÖ Excellent</option>
                                    <option value="good" ${fiaData.status === 'good' ? 'selected' : ''}>üëç Good</option>
                                    <option value="fair" ${fiaData.status === 'fair' ? 'selected' : ''}>‚ö†Ô∏è Fair</option>
                                    <option value="poor" ${fiaData.status === 'poor' ? 'selected' : ''}>‚ùå Poor</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Last Checked</label>
                                <input type="datetime-local" 
                                    value="${fiaData.lastChecked || ''}"
                                    onchange="updateFIALastChecked('${area.id}', this.value)">
                            </div>
                        </div>
                        <div style="margin-top: 8px;">
                            <textarea placeholder="FIA counters notes..."
                                onchange="updateFIANotes('${area.id}', this.value)">${fiaData.notes || ''}</textarea>
                        </div>
                        ${fiaData.timeChecked ? `
                            <div class="time-checked-container">
                                <span class="time-checked-label">‚è∞ Time Checked:</span>
                                <span class="time-checked-value">${fiaData.timeChecked}</span>
                            </div>
                        ` : '<div class="time-checked-container"><span class="time-checked-label">‚è∞ Time Checked:</span><span class="time-checked-value">Not yet checked</span></div>'}
                    </div>
                `;
            }
            
            // d) Add Conveyor Belt Steel Section
            if (area.hasConveyorBelt) {
                const beltKey = `${area.id}-conveyor-belt`;
                const beltData = data[beltKey] || {};
                const beltElementId = `${area.id}-belt-section`;
                content += `
                    <div class="conveyor-belt-group" id="${beltElementId}">
                        <div class="conveyor-belt-title">
                            üîÑ Conveyor Belt Steel Section
                        </div>
                        <div class="grid-2">
                            <div class="input-group">
                                <label>Status</label>
                                <select class="status status-${beltData.status || 'pending'}" 
                                    onchange="updateBeltStatus('${area.id}', this.value, '${beltElementId}', 'Conveyor Belt')">
                                    <option value="pending" ${beltData.status === 'pending' ? 'selected' : ''}>‚è±Ô∏è Pending</option>
                                    <option value="excellent" ${beltData.status === 'excellent' ? 'selected' : ''}>‚úÖ Excellent</option>
                                    <option value="good" ${beltData.status === 'good' ? 'selected' : ''}>üëç Good</option>
                                    <option value="fair" ${beltData.status === 'fair' ? 'selected' : ''}>‚ö†Ô∏è Fair</option>
                                    <option value="poor" ${beltData.status === 'poor' ? 'selected' : ''}>‚ùå Poor</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Last Cleaned</label>
                                <input type="datetime-local" 
                                    value="${beltData.lastCleaned || ''}"
                                    onchange="updateBeltLastCleaned('${area.id}', this.value)">
                            </div>
                        </div>
                        <div style="margin-top: 8px;">
                            <textarea placeholder="Conveyor belt notes..."
                                onchange="updateBeltNotes('${area.id}', this.value)">${beltData.notes || ''}</textarea>
                        </div>
                        ${beltData.timeChecked ? `
                            <div class="time-checked-container">
                                <span class="time-checked-label">‚è∞ Time Checked:</span>
                                <span class="time-checked-value">${beltData.timeChecked}</span>
                            </div>
                        ` : '<div class="time-checked-container"><span class="time-checked-label">‚è∞ Time Checked:</span><span class="time-checked-value">Not yet checked</span></div>'}
                    </div>
                `;
            }
            
            // b) Add Web Clean to Level 0 and e) Web sections
            if (area.hasWebClean) {
                const webKey = `${area.id}-web-clean`;
                const webData = data[webKey] || {};
                const webElementId = `${area.id}-web-section`;
                content += `
                    <div class="web-clean-group" id="${webElementId}">
                        <div class="web-clean-title">
                            üï∏Ô∏è Web Cleaning Status
                        </div>
                        <div class="grid-2">
                            <div class="input-group">
                                <label>Status</label>
                                <select class="status status-${webData.status || 'pending'}" 
                                    onchange="updateWebCleanStatus('${area.id}', this.value, '${webElementId}', 'Web Cleaning')">
                                    <option value="pending" ${webData.status === 'pending' ? 'selected' : ''}>‚è±Ô∏è Pending</option>
                                    <option value="completed" ${webData.status === 'completed' ? 'selected' : ''}>‚úÖ Completed</option>
                                    <option value="in-progress" ${webData.status === 'in-progress' ? 'selected' : ''}>üîÑ In Progress</option>
                                    <option value="not-started" ${webData.status === 'not-started' ? 'selected' : ''}>‚è∏Ô∏è Not Started</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Last Cleaned</label>
                                <input type="date" 
                                    value="${webData.lastCleaned || ''}"
                                    onchange="updateWebCleanDate('${area.id}', this.value)">
                            </div>
                        </div>
                        <div style="margin-top: 8px;">
                            <textarea placeholder="Web cleaning notes..."
                                onchange="updateWebCleanNotes('${area.id}', this.value)">${webData.notes || ''}</textarea>
                        </div>
                        ${webData.timeChecked ? `
                            <div class="time-checked-container">
                                <span class="time-checked-label">‚è∞ Time Checked:</span>
                                <span class="time-checked-value">${webData.timeChecked}</span>
                            </div>
                        ` : '<div class="time-checked-container"><span class="time-checked-label">‚è∞ Time Checked:</span><span class="time-checked-value">Not yet checked</span></div>'}
                    </div>
                `;
            }
            
            // Add dustbins section if applicable
            if (area.hasDustbins) {
                const dustbinsKey = `${area.id}-dustbins`;
                const dustbinsData = data[dustbinsKey] || {};
                const dustbinsElementId = `${area.id}-dustbins-section`;
                content += `
                    <div class="dustbins-check-group" id="${dustbinsElementId}">
                        <div class="dustbins-title">
                            üóëÔ∏è Dustbins Inspection
                        </div>
                        <div class="dustbins-grid">
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üì¶ Full?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-full" value="yes" 
                                            ${dustbinsData.fullOfGarbage === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'fullOfGarbage', 'yes', '${dustbinsElementId}', 'Dustbins')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-full" value="no" 
                                            ${dustbinsData.fullOfGarbage === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'fullOfGarbage', 'no', '${dustbinsElementId}', 'Dustbins')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üßπ Clean?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-cleaned" value="yes" 
                                            ${dustbinsData.cleaned === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'cleaned', 'yes', '${dustbinsElementId}', 'Dustbins')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-cleaned" value="no" 
                                            ${dustbinsData.cleaned === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'cleaned', 'no', '${dustbinsElementId}', 'Dustbins')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    ‚è∞ On Time?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-emptied" value="yes" 
                                            ${dustbinsData.emptiedTimely === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'emptiedTimely', 'yes', '${dustbinsElementId}', 'Dustbins')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-emptied" value="no" 
                                            ${dustbinsData.emptiedTimely === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'emptiedTimely', 'no', '${dustbinsElementId}', 'Dustbins')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üìÖ Last Empty
                                </div>
                                <input type="datetime-local" 
                                    value="${dustbinsData.lastEmptied || ''}"
                                    onchange="updateDustbinsLastEmptied('${area.id}', this.value)">
                            </div>
                        </div>
                        
                        <div style="margin-top: 8px;">
                            <textarea placeholder="Dustbins notes..."
                                onchange="updateDustbinsNotes('${area.id}', this.value)">${dustbinsData.notes || ''}</textarea>
                        </div>
                        ${dustbinsData.timeChecked ? `
                            <div class="time-checked-container">
                                <span class="time-checked-label">‚è∞ Time Checked:</span>
                                <span class="time-checked-value">${dustbinsData.timeChecked}</span>
                            </div>
                        ` : '<div class="time-checked-container"><span class="time-checked-label">‚è∞ Time Checked:</span><span class="time-checked-value">Not yet checked</span></div>'}
                    </div>
                `;
            }
            
            // e) Special layout for Level 0 Big Section
            if (area.isLevel0) {
                const level0ToiletWallsElementId = 'level0-toilet-walls-section';
                const level0ToiletWallsData = data['level0-toilet-walls'] || {};
                content += `
                    <div class="level0-grid">
                        <div class="level0-subsection">
                            <div class="subsection-title">üè¢ Concourse Hall Level 0</div>
                            ${renderLocation(area.id, 'Concourse Hall Level 0 (General)')}
                        </div>
                        
                        <div class="level0-subsection">
                            <div class="subsection-title">üöª Toilets Level 0</div>
                            ${renderLocation(area.id, 'Concourse Hall - Gents Toilet')}
                            ${renderLocation(area.id, 'Concourse Hall - Ladies Toilet')}
                            ${renderLocation(area.id, 'Concourse Hall - Wheelchair Toilet')}
                            <div class="walls-check-group" style="margin-top: 10px;" id="${level0ToiletWallsElementId}">
                                <div class="walls-title">
                                    üß± Toilet Walls Condition
                                </div>
                                <div class="walls-options">
                                    <label class="wall-option">
                                        <input type="radio" name="level0-toilet-walls" value="clean" 
                                            ${level0ToiletWallsData.status === 'clean' ? 'checked' : ''}
                                            onchange="updateToiletWalls('level0', 'clean', '${level0ToiletWallsElementId}', 'Toilet Walls')">
                                        <span class="wall-tick">‚úÖ Clean</span>
                                    </label>
                                    <label class="wall-option">
                                        <input type="radio" name="level0-toilet-walls" value="dirty" 
                                            ${level0ToiletWallsData.status === 'dirty' ? 'checked' : ''}
                                            onchange="updateToiletWalls('level0', 'dirty', '${level0ToiletWallsElementId}', 'Toilet Walls')">
                                        <span class="wall-cross">‚ùå Dirty</span>
                                    </label>
                                </div>
                                ${level0ToiletWallsData.timeChecked ? `
                                    <div class="time-checked-container">
                                        <span class="time-checked-label">‚è∞ Time Checked:</span>
                                        <span class="time-checked-value">${level0ToiletWallsData.timeChecked}</span>
                                    </div>
                                ` : '<div class="time-checked-container"><span class="time-checked-label">‚è∞ Time Checked:</span><span class="time-checked-value">Not yet checked</span></div>'}
                            </div>
                        </div>
                        
                        <div class="level0-subsection">
                            <div class="subsection-title">üï∏Ô∏è Web Cleaning Sections</div>
                            ${renderLocation(area.id, 'Web Cleaning North Section')}
                            ${renderLocation(area.id, 'Web Cleaning South Section')}
                        </div>
                        
                        <div class="level0-subsection">
                            <div class="subsection-title">üö∂ Access Areas</div>
                            ${renderLocation(area.id, 'Staircases Level 0')}
                            ${renderLocation(area.id, 'Corridors & Passageways')}
                        </div>
                    </div>
                `;
            } else {
                // Regular locations for other areas
                content += area.locations.map(loc => renderLocation(area.id, loc)).join('');
            }
            
            return content;
        }

        function renderLocation(areaId, location) {
            const key = `${areaId}-${location.replace(/\s+/g, '_')}`;
            const d = data[key] || {};
            const diff = d.actualStaff && d.statedStaff ? parseInt(d.actualStaff) - parseInt(d.statedStaff) : '';
            const diffClass = diff < 0 ? 'diff-negative' : diff > 0 ? 'diff-positive' : 'diff-neutral';
            const elementId = key.replace(/_/g, '-');

            return `
                <div class="location-card" id="${elementId}">
                    <div class="location-title">${location}</div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Status</label>
                            <select class="status status-${d.status || 'pending'}" 
                                onchange="updateDataWithTimeChecked('${key}', 'status', this.value, '${elementId}', '${location}')">
                                <option value="pending" ${d.status === 'pending' ? 'selected' : ''}>‚è±Ô∏è Pending</option>
                                <option value="excellent" ${d.status === 'excellent' ? 'selected' : ''}>‚úÖ Excellent</option>
                                <option value="good" ${d.status === 'good' ? 'selected' : ''}>üëç Good</option>
                                <option value="fair" ${d.status === 'fair' ? 'selected' : ''}>‚ö†Ô∏è Fair</option>
                                <option value="poor" ${d.status === 'poor' ? 'selected' : ''}>‚ùå Poor</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Score (%)</label>
                            <input type="number" value="${d.score || ''}" min="0" max="100" placeholder="0-100" 
                                onchange="updateDataWithTimeChecked('${key}', 'score', this.value, '${elementId}', '${location}')" />
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" ${d.deepClean ? 'checked' : ''} 
                                onchange="updateDataWithTimeChecked('${key}', 'deepClean', this.checked, '${elementId}', '${location}')" />
                            Deep Clean
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" ${d.routineClean ? 'checked' : ''} 
                                onchange="updateDataWithTimeChecked('${key}', 'routineClean', this.checked, '${elementId}', '${location}')" />
                            Routine Clean
                        </label>
                    </div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Manpower</label>
                            <input type="text" value="${d.manpower || ''}" 
                                onchange="updateDataWithTimeChecked('${key}', 'manpower', this.value, '${elementId}', '${location}')" />
                        </div>
                        <div class="input-group">
                            <label>Material</label>
                            <input type="text" value="${d.material || ''}" 
                                onchange="updateDataWithTimeChecked('${key}', 'material', this.value, '${elementId}', '${location}')" />
                        </div>
                    </div>
                    <div class="grid-3">
                        <div class="input-group">
                            <label>Stated Staff</label>
                            <input type="number" value="${d.statedStaff || ''}" 
                                onchange="updateDataWithTimeChecked('${key}', 'statedStaff', this.value, '${elementId}', '${location}')" />
                        </div>
                        <div class="input-group">
                            <label>Actual Staff</label>
                            <input type="number" value="${d.actualStaff || ''}" 
                                onchange="updateDataWithTimeChecked('${key}', 'actualStaff', this.value, '${elementId}', '${location}')" />
                        </div>
                        <div class="input-group">
                            <label>Difference</label>
                            <div class="diff-display ${diffClass}">
                                ${diff !== '' ? (diff > 0 ? '+' + diff : diff) : '-'}
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Notes</label>
                        <textarea rows="2" placeholder="Add notes..." 
                            onchange="updateDataWithTimeChecked('${key}', 'notes', this.value, '${elementId}', '${location}')">${d.notes || ''}</textarea>
                    </div>
                    ${d.timeChecked ? `
                        <div class="time-checked-container">
                            <span class="time-checked-label">‚è∞ Time Checked:</span>
                            <span class="time-checked-value">${d.timeChecked}</span>
                        </div>
                    ` : '<div class="time-checked-container"><span class="time-checked-label">‚è∞ Time Checked:</span><span class="time-checked-value">Not yet checked</span></div>'}
                </div>
            `;
        }

        // ==================== DATA MANAGEMENT ====================
        function updateData(key, field, value) {
            if (!data[key]) data[key] = {};
            data[key][field] = value;
            localStorage.setItem('airportCleanlinessData', JSON.stringify(data));
            updateStats();
        }

        // Walls functions with time checked
        function updateWallsStatus(areaId, status, elementId, label) {
            const key = `${areaId}-walls`;
            updateDataWithTimeChecked(key, 'wallsStatus', status, elementId, label);
        }

        function updateWallsNotes(areaId, value, elementId, label) {
            const key = `${areaId}-walls`;
            updateDataWithTimeChecked(key, 'notes', value, elementId, label);
        }

        function updateToiletWalls(areaId, status, elementId, label) {
            const key = `${areaId}-toilet-walls`;
            updateDataWithTimeChecked(key, 'status', status, elementId, label);
        }

        // FIA Counter functions with time checked
        function updateFIAStatus(areaId, status, elementId, label) {
            const key = `${areaId}-fia-counters`;
            updateDataWithTimeChecked(key, 'status', status, elementId, label);
        }

        function updateFIALastChecked(areaId, value) {
            const key = `${areaId}-fia-counters`;
            updateData(key, 'lastChecked', value);
        }

        function updateFIANotes(areaId, value) {
            const key = `${areaId}-fia-counters`;
            updateData(key, 'notes', value);
        }

        // Conveyor Belt functions with time checked
        function updateBeltStatus(areaId, status, elementId, label) {
            const key = `${areaId}-conveyor-belt`;
            updateDataWithTimeChecked(key, 'status', status, elementId, label);
        }

        function updateBeltLastCleaned(areaId, value) {
            const key = `${areaId}-conveyor-belt`;
            updateData(key, 'lastCleaned', value);
        }

        function updateBeltNotes(areaId, value) {
            const key = `${areaId}-conveyor-belt`;
            updateData(key, 'notes', value);
        }

        // Web Clean functions with time checked
        function updateWebCleanStatus(areaId, status, elementId, label) {
            const key = `${areaId}-web-clean`;
            updateDataWithTimeChecked(key, 'status', status, elementId, label);
        }

        function updateWebCleanDate(areaId, value) {
            const key = `${areaId}-web-clean`;
            updateData(key, 'lastCleaned', value);
        }

        function updateWebCleanNotes(areaId, value) {
            const key = `${areaId}-web-clean`;
            updateData(key, 'notes', value);
        }

        // Dustbins functions with time checked
        function updateDustbins(areaId, field, value, elementId, label) {
            const key = `${areaId}-dustbins`;
            updateDataWithTimeChecked(key, field, value, elementId, label);
        }

        function updateDustbinsLastEmptied(areaId, value) {
            const key = `${areaId}-dustbins`;
            updateData(key, 'lastEmptied', value);
        }

        function updateDustbinsNotes(areaId, value) {
            const key = `${areaId}-dustbins`;
            updateData(key, 'notes', value);
        }

        // ==================== UI FUNCTIONS ====================
        function toggleSection(id) {
            const content = document.getElementById(`content-${id}`);
            if (!content) return;
            
            const isActive = content.classList.contains('active');
            
            // Close all other sections
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // Toggle current section
            if (!isActive) {
                content.classList.add('active');
            }
        }

        function updateStats() {
            const values = Object.values(data);
            const stats = {
                excellent: values.filter(v => v.status === 'excellent').length,
                good: values.filter(v => v.status === 'good').length,
                fair: values.filter(v => v.status === 'fair').length,
                poor: values.filter(v => v.status === 'poor').length,
                pending: values.filter(v => v.status === 'pending' || !v.status).length,
                wallsClean: values.filter(v => v.wallsStatus === 'clean').length,
                webCompleted: values.filter(v => v.status === 'completed' && v.notes && v.notes.includes('web')).length,
                fiaExcellent: values.filter(v => v.status === 'excellent' && v.notes && v.notes.includes('fia')).length,
                beltGood: values.filter(v => v.status === 'good' && v.notes && v.notes.includes('belt')).length
            };
            
            const scores = values.filter(v => v.score !== '' && v.score !== undefined).map(v => parseInt(v.score) || 0);
            const avgScore = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
            
            // Dustbin stats
            const dustbinData = Object.entries(data).filter(([key]) => key.includes('dustbins'));
            const dustbinStats = {
                fullYes: dustbinData.filter(([_, v]) => v.fullOfGarbage === 'yes').length,
                cleanedYes: dustbinData.filter(([_, v]) => v.cleaned === 'yes').length,
                emptiedYes: dustbinData.filter(([_, v]) => v.emptiedTimely === 'yes').length
            };

            const statsContainer = document.getElementById('stats');
            if (!statsContainer) return;
            
            statsContainer.innerHTML = `
                <div class="stat-card excellent">
                    <div class="stat-label">Excellent</div>
                    <div class="stat-value">${stats.excellent}</div>
                </div>
                <div class="stat-card good">
                    <div class="stat-label">Good</div>
                    <div class="stat-value">${stats.good}</div>
                </div>
                <div class="stat-card fair">
                    <div class="stat-label">Fair</div>
                    <div class="stat-value">${stats.fair}</div>
                </div>
                <div class="stat-card poor">
                    <div class="stat-label">Poor</div>
                    <div class="stat-value">${stats.poor}</div>
                </div>
                <div class="stat-card avg">
                    <div class="stat-label">Avg Score</div>
                    <div class="stat-value">${avgScore}%</div>
                </div>
                <div class="stat-card ${dustbinStats.fullYes === 0 ? 'good' : 'poor'}">
                    <div class="stat-label">Full Bins</div>
                    <div class="stat-value">${dustbinStats.fullYes}</div>
                </div>
                <div class="stat-card walls-clean">
                    <div class="stat-label">Walls Clean</div>
                    <div class="stat-value">${stats.wallsClean}</div>
                </div>
                <div class="stat-card web-clean">
                    <div class="stat-label">Web Cleaned</div>
                    <div class="stat-value">${stats.webCompleted}</div>
                </div>
                <div class="stat-card fia-excellent">
                    <div class="stat-label">FIA Excellent</div>
                    <div class="stat-value">${stats.fiaExcellent}</div>
                </div>
                <div class="stat-card belt-good">
                    <div class="stat-label">Belts Good</div>
                    <div class="stat-value">${stats.beltGood}</div>
                </div>
            `;
        }

        // ==================== EXPORT FUNCTIONS ====================
        function exportCSV() {
            let csv = 'Date,Shift,Time,Inspector,Area,Section,Type,Status,Score,Deep Clean,Routine Clean,Manpower,Material,Stated Staff,Actual Staff,Difference,Notes,Walls Status,FIA Status,Belt Status,Web Status,Last Cleaned,Last Emptied,Time Checked\n';
            const date = document.getElementById('date')?.value || '';
            const shift = document.getElementById('shift')?.value || '';
            const time = document.getElementById('time')?.value || '';
            const inspector = document.getElementById('inspector')?.value || '';

            areas.forEach(area => {
                // Export locations
                area.locations.forEach(loc => {
                    const key = `${area.id}-${loc.replace(/\s+/g, '_')}`;
                    const d = data[key] || {};
                    const diff = d.actualStaff && d.statedStaff ? parseInt(d.actualStaff) - parseInt(d.statedStaff) : '';
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","${loc}","Location","${d.status || ''}","${d.score || ''}","${d.deepClean || false}","${d.routineClean || false}","${d.manpower || ''}","${d.material || ''}","${d.statedStaff || ''}","${d.actualStaff || ''}","${diff}","${d.notes || ''}","","","","","","${d.timeChecked || ''}"\n`;
                });
                
                // Export walls data
                if (area.hasWalls) {
                    const wallsKey = `${area.id}-walls`;
                    const wallsData = data[wallsKey] || {};
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","Walls","Walls","","","","","","","","","","${wallsData.wallsStatus || ''}","","","","","","${wallsData.timeChecked || ''}"\n`;
                }
                
                // Export toilet walls
                if (area.hasToilets) {
                    const toiletWallsKey = `${area.id}-toilet-walls`;
                    const toiletWallsData = data[toiletWallsKey] || {};
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","Toilet Walls","Walls","","","","","","","","","","${toiletWallsData.status || ''}","","","","","","${toiletWallsData.timeChecked || ''}"\n`;
                }
                
                // Export FIA counters
                if (area.hasFIACounters) {
                    const fiaKey = `${area.id}-fia-counters`;
                    const fiaData = data[fiaKey] || {};
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","FIA Counters","FIA","${fiaData.status || ''}","","","","","","","","","","${fiaData.status || ''}","","","${fiaData.lastChecked || ''}","","${fiaData.timeChecked || ''}"\n`;
                }
                
                // Export conveyor belts
                if (area.hasConveyorBelt) {
                    const beltKey = `${area.id}-conveyor-belt`;
                    const beltData = data[beltKey] || {};
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","Conveyor Belt","Belt","${beltData.status || ''}","","","","","","","","","","","${beltData.status || ''}","","${beltData.lastCleaned || ''}","","${beltData.timeChecked || ''}"\n`;
                }
                
                // Export web cleaning
                if (area.hasWebClean) {
                    const webKey = `${area.id}-web-clean`;
                    const webData = data[webKey] || {};
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","Web Cleaning","Web","${webData.status || ''}","","","","","","","","","","","","${webData.status || ''}","${webData.lastCleaned || ''}","","${webData.timeChecked || ''}"\n`;
                }
                
                // Export dustbins data
                if (area.hasDustbins) {
                    const dustbinsKey = `${area.id}-dustbins`;
                    const dustbinsData = data[dustbinsKey] || {};
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","Dustbins","Dustbins","","","","","","","","","","","","","","","${dustbinsData.lastEmptied || ''}","${dustbinsData.timeChecked || ''}"\n`;
                }
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `airport-cleanliness-${date || 'report'}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function resetAll() {
            if (confirm('Reset all data? This cannot be undone.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // ==================== INITIALIZE APP ====================
        // Wait for DOM to be fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
        // Mobile viewport fix
        window.addEventListener('resize', function() {
            document.body.style.width = '100%';
        });
    </script>
</body>
</html>