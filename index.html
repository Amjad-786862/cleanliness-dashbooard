<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Configuration -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AirportClean">
    <meta name="application-name" content="AirportClean">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#2563eb" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1e40af" media="(prefers-color-scheme: dark)">
    <meta name="msapplication-TileColor" content="#2563eb">
    
    <title>Airport Cleanliness</title>
    
    <!-- Inline Manifest -->
    <link rel="manifest" id="manifest">
    
    <!-- Simple icon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úàÔ∏è</text></svg>">
    
    <style>
        /* Reset and base styles */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding-bottom: 20px;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Header */
        .header { 
            background: linear-gradient(90deg, #2563eb 0%, #4f46e5 100%); 
            color: white; 
            padding: 16px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        .header h1 { 
            font-size: clamp(18px, 5vw, 22px); 
            font-weight: bold; 
            margin-bottom: 4px; 
        }
        .header p { 
            font-size: 12px; 
            opacity: 0.9; 
        }
        
        /* Content */
        .content { 
            padding: 12px; 
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* Form Card */
        .card { 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            padding: 16px; 
            margin-bottom: 12px;
            width: 100%;
            overflow: hidden;
        }
        
        /* Input Groups */
        .input-group { 
            margin-bottom: 12px; 
            width: 100%;
        }
        .input-group label { 
            display: block; 
            font-size: 14px; 
            font-weight: 500; 
            color: #374151; 
            margin-bottom: 6px; 
        }
        .input-group input, 
        .input-group select, 
        .input-group textarea { 
            width: 100%; 
            padding: 10px 12px; 
            border: 1px solid #d1d5db; 
            border-radius: 8px; 
            font-size: 15px; 
            -webkit-appearance: none;
        }
        .input-group input:focus, 
        .input-group select:focus, 
        .input-group textarea:focus { 
            outline: none; 
            border-color: #2563eb; 
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1); 
        }
        
        /* Buttons */
        .btn-group { 
            display: flex; 
            flex-wrap: wrap;
            gap: 8px; 
            margin-top: 16px; 
            width: 100%;
        }
        .btn { 
            flex: 1 1 calc(50% - 8px);
            min-width: 0;
            padding: 12px; 
            border: none; 
            border-radius: 8px; 
            font-size: 14px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 6px; 
            transition: all 0.2s; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .btn:active { transform: scale(0.98); }
        .btn-green { background: #16a34a; color: white; }
        .btn-blue { background: #2563eb; color: white; }
        .btn-red { background: #dc2626; color: white; }
        
        /* Stats Grid */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 8px; 
            margin-bottom: 12px; 
        }
        @media (min-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .stat-card { 
            background: white; 
            border-radius: 8px; 
            padding: 12px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            text-align: center; 
            min-width: 0;
        }
        .stat-card.excellent { background: #16a34a; color: white; }
        .stat-card.good { background: #2563eb; color: white; }
        .stat-card.fair { background: #eab308; color: white; }
        .stat-card.poor { background: #dc2626; color: white; }
        .stat-card.pending { background: #6b7280; color: white; }
        .stat-card.avg { background: #4f46e5; color: white; }
        .stat-label { 
            font-size: 11px; 
            opacity: 0.9; 
            margin-bottom: 4px; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .stat-value { 
            font-size: 20px; 
            font-weight: bold; 
            line-height: 1.2;
        }
        
        /* Sections */
        .section { 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            margin-bottom: 12px; 
            overflow: hidden; 
            width: 100%;
        }
        .section-header { 
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%); 
            color: white; 
            padding: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-size: 15px;
        }
        .section-content { 
            padding: 12px; 
            display: none; 
            width: 100%;
            overflow: hidden;
        }
        .section-content.active { display: block; }
        
        /* Location Cards */
        .location-card { 
            background: #f9fafb; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 12px; 
            margin-bottom: 12px; 
            width: 100%;
            overflow: hidden;
        }
        .location-title { 
            font-weight: 600; 
            color: #1f2937; 
            font-size: 14px; 
            margin-bottom: 12px; 
            line-height: 1.4;
        }
        
        /* Grids - Responsive */
        .grid-2 { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 8px; 
            margin-bottom: 8px; 
            width: 100%;
        }
        .grid-3 { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px; 
            margin-bottom: 8px; 
            width: 100%;
        }
        
        /* Checkbox Groups */
        .checkbox-group { 
            display: flex; 
            flex-wrap: wrap;
            gap: 12px; 
            margin-bottom: 12px; 
            width: 100%;
        }
        .checkbox-label { 
            display: flex; 
            align-items: center; 
            font-size: 13px; 
            flex: 1 1 auto;
            min-width: 120px;
        }
        .checkbox-label input { 
            margin-right: 6px; 
            min-width: 18px;
            height: 18px;
        }
        
        /* Status Colors */
        select.status { 
            color: white; 
            font-weight: 600; 
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: none;
            font-size: 14px;
        }
        .status-excellent { background: #16a34a; }
        .status-good { background: #2563eb; }
        .status-fair { background: #eab308; }
        .status-poor { background: #dc2626; }
        .status-pending { background: #6b7280; }
        
        /* Difference Display */
        .diff-positive { background: #dcfce7; color: #166534; }
        .diff-negative { background: #fee2e2; color: #991b1b; }
        .diff-neutral { background: #f3f4f6; color: #6b7280; }
        .diff-display { 
            padding: 8px 4px; 
            border-radius: 6px; 
            font-size: 13px; 
            font-weight: 600; 
            text-align: center; 
            min-width: 0;
            overflow: hidden;
        }
        
        /* Print Styles */
        @media print { 
            .no-print { display: none !important; } 
            body { background: white; }
            .card { box-shadow: none; border: 1px solid #ddd; }
        }
        
        /* ==================== DUSTBINS SECTION - FIXED ==================== */
        .dustbins-check-group {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        .dustbins-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
        }
        
        /* Fixed Grid - Single column on mobile */
        .dustbins-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 12px;
            width: 100%;
        }
        
        /* On larger screens, show 2 columns */
        @media (min-width: 480px) {
            .dustbins-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
        }
        
        .dustbin-criteria {
            background: white;
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 10px;
            min-width: 0;
            overflow: hidden;
            box-sizing: border-box;
        }
        .criteria-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .criteria-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            width: 100%;
        }
        .criteria-option {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            flex: 1;
            min-width: 60px;
        }
        .criteria-option input[type="radio"] {
            margin: 0;
            min-width: 18px;
            height: 18px;
        }
        .yes-option { 
            color: #16a34a; 
            font-size: 12px;
            white-space: nowrap;
        }
        .no-option { 
            color: #dc2626; 
            font-size: 12px;
            white-space: nowrap;
        }
        
        /* Date input in dustbins */
        .dustbin-criteria input[type="datetime-local"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        /* Dustbins notes textarea */
        .dustbins-notes {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            min-height: 60px;
            resize: vertical;
            margin-top: 8px;
        }
        
        /* Footer */
        .github-fix {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #f8fafc;
            border-top: 1px solid #e5e7eb;
            padding: 10px;
            text-align: center;
            font-size: 11px;
            color: #6b7280;
            z-index: 999;
        }
        
        /* Mobile optimizations */
        @media (max-width: 360px) {
            .btn {
                font-size: 12px;
                padding: 10px 6px;
            }
            .stat-value {
                font-size: 18px;
            }
            .grid-3 {
                grid-template-columns: 1fr 1fr;
            }
            .criteria-options {
                gap: 6px;
            }
        }
        
        /* Ensure no horizontal scrolling */
        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* Touch-friendly sizes */
        input, select, textarea, button {
            font-size: 16px !important; /* Prevents iOS zoom */
            min-height: 44px; /* Apple recommended touch target */
        }
        
        .checkbox-label input[type="checkbox"],
        .criteria-option input[type="radio"] {
            min-height: 20px;
            min-width: 20px;
        }
    </style>
    
    <script>
        // Set manifest dynamically
        document.addEventListener('DOMContentLoaded', function() {
            const manifest = {
                "name": "Airport Cleanliness",
                "short_name": "AirportClean",
                "description": "Daily Airport Cleanliness Inspection",
                "start_url": "./",
                "display": "standalone",
                "background_color": "#2563eb",
                "theme_color": "#2563eb",
                "orientation": "portrait",
                "icons": []
            };
            
            const blob = new Blob([JSON.stringify(manifest)], {type: 'application/manifest+json'});
            const url = URL.createObjectURL(blob);
            document.getElementById('manifest').href = url;
        });
    </script>
</head>
<body>
    <div class="header">
        <h1>‚úàÔ∏è Airport Cleanliness</h1>
        <p>Daily Inspection & Monitoring</p>
    </div>

    <div class="content">
        <div class="card">
            <div class="input-group">
                <label>üìÖ Date</label>
                <input type="date" id="date" />
            </div>
            <div class="input-group">
                <label>üïê Shift</label>
                <select id="shift">
                    <option value="">Select Shift</option>
                    <option value="morning">Morning (8 AM - 2 PM)</option>
                    <option value="evening">Evening (2 PM - 8 PM)</option>
                    <option value="night">Night (8 PM - 8 AM)</option>
                </select>
            </div>
            <div class="input-group">
                <label>‚è∞ Time</label>
                <input type="time" id="time" />
            </div>
            <div class="input-group">
                <label>üë§ Inspector</label>
                <input type="text" id="inspector" placeholder="Enter inspector name" />
            </div>
            <div class="btn-group no-print">
                <button class="btn btn-green" onclick="exportCSV()">
                    üì• CSV
                </button>
                <button class="btn btn-blue" onclick="window.print()">
                    üñ®Ô∏è Print
                </button>
                <button class="btn btn-red" onclick="resetAll()">
                    üîÑ Reset
                </button>
            </div>
        </div>

        <div class="stats-grid" id="stats">
            <!-- Stats will be populated -->
        </div>

        <div id="sections">
            <!-- Sections will be populated -->
        </div>
    </div>
    
    <div class="github-fix no-print">
        Airport Cleanliness App | Works offline | Data saved locally
    </div>

    <script>
        // ==================== APP DATA ====================
        const areas = [
            { 
                id: 'apron', 
                name: '‚úàÔ∏è Apron Area', 
                locations: [
                    'Apron Area North Side',
                    'Apron Area South Side',
                    'Apron Toilet North Side',
                    'Apron Toilet South Side',
                    'Bridge Stairs Cleanliness'
                ],
                hasDustbins: true
            },
            { 
                id: 'international', 
                name: 'üåç International Arrival', 
                locations: [
                    'Immigration Area',
                    'Intl. Arrival Hall',
                    'Gents Toilet',
                    'Ladies Toilet',
                    'Wheelchair Toilet',
                    'Belts Area'
                ],
                hasDustbins: true
            },
            { 
                id: 'domestic', 
                name: 'üè† Domestic Arrival', 
                locations: [
                    'Dom. Arrival Hall',
                    'Gents Toilet',
                    'Ladies Toilet',
                    'Wheelchair Toilet',
                    'Belts Area'
                ],
                hasDustbins: true
            },
            { 
                id: 'concourse', 
                name: 'üèõÔ∏è Concourse Hall', 
                locations: [
                    'Concourse North Side',
                    'Concourse South Side',
                    'Gents Toilet',
                    'Ladies Toilet',
                    'Wheelchair Toilet'
                ],
                hasDustbins: true
            },
            { 
                id: 'parking', 
                name: 'üöó Parking & Roads', 
                locations: [
                    'Parking Area North',
                    'Parking Area South',
                    'Parking Central',
                    'Entry/Exit Points'
                ],
                hasDustbins: true
            }
        ];

        let data = {};

        // ==================== INITIALIZATION ====================
        function init() {
            // Load saved data
            const saved = localStorage.getItem('airportCleanlinessData');
            if (saved) {
                try {
                    data = JSON.parse(saved);
                } catch (e) {
                    data = {};
                }
            }
            
            // Initialize with default data if needed
            areas.forEach(area => {
                area.locations.forEach(loc => {
                    const key = `${area.id}-${loc.replace(/\s+/g, '_')}`;
                    if (!data[key]) {
                        data[key] = { 
                            status: 'pending', 
                            score: '', 
                            deepClean: false, 
                            routineClean: false, 
                            manpower: '', 
                            material: '', 
                            statedStaff: '', 
                            actualStaff: '', 
                            notes: ''
                        };
                    }
                });
                
                // Initialize dustbins data
                if (area.hasDustbins) {
                    const dustbinsKey = `${area.id}-dustbins`;
                    if (!data[dustbinsKey]) {
                        data[dustbinsKey] = { 
                            fullOfGarbage: 'pending',
                            cleaned: 'pending',
                            emptiedTimely: 'pending',
                            lastEmptied: '',
                            notes: ''
                        };
                    }
                }
            });

            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            const dateEl = document.getElementById('date');
            if (dateEl) dateEl.value = localStorage.getItem('inspectionDate') || today;
            
            // Load other form data
            const shiftEl = document.getElementById('shift');
            const timeEl = document.getElementById('time');
            const inspectorEl = document.getElementById('inspector');
            
            if (shiftEl) shiftEl.value = localStorage.getItem('inspectionShift') || '';
            if (timeEl) timeEl.value = localStorage.getItem('inspectionTime') || '';
            if (inspectorEl) inspectorEl.value = localStorage.getItem('inspectionInspector') || '';

            // Render everything
            renderSections();
            updateStats();

            // Auto-save form data
            if (dateEl) dateEl.addEventListener('change', e => {
                localStorage.setItem('inspectionDate', e.target.value);
            });
            if (shiftEl) shiftEl.addEventListener('change', e => {
                localStorage.setItem('inspectionShift', e.target.value);
            });
            if (timeEl) timeEl.addEventListener('change', e => {
                localStorage.setItem('inspectionTime', e.target.value);
            });
            if (inspectorEl) inspectorEl.addEventListener('input', e => {
                localStorage.setItem('inspectionInspector', e.target.value);
            });
            
            // Ensure mobile viewport works
            document.body.style.width = '100%';
            document.body.style.overflowX = 'hidden';
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderSections() {
            const container = document.getElementById('sections');
            if (!container) return;
            
            container.innerHTML = areas.map(area => `
                <div class="section">
                    <div class="section-header" onclick="toggleSection('${area.id}')">
                        <span>${area.name}</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="section-content" id="content-${area.id}">
                        ${renderAreaContent(area)}
                    </div>
                </div>
            `).join('');
        }

        function renderAreaContent(area) {
            let content = '';
            
            // Add dustbins section if applicable
            if (area.hasDustbins) {
                const dustbinsKey = `${area.id}-dustbins`;
                const dustbinsData = data[dustbinsKey] || {};
                content += `
                    <div class="dustbins-check-group">
                        <div class="dustbins-title">
                            üóëÔ∏è Dustbins Inspection
                        </div>
                        <div class="dustbins-grid">
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üì¶ Full?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-full" value="yes" 
                                            ${dustbinsData.fullOfGarbage === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'fullOfGarbage', 'yes')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-full" value="no" 
                                            ${dustbinsData.fullOfGarbage === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'fullOfGarbage', 'no')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üßπ Clean?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-cleaned" value="yes" 
                                            ${dustbinsData.cleaned === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'cleaned', 'yes')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-cleaned" value="no" 
                                            ${dustbinsData.cleaned === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'cleaned', 'no')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    ‚è∞ On Time?
                                </div>
                                <div class="criteria-options">
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-emptied" value="yes" 
                                            ${dustbinsData.emptiedTimely === 'yes' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'emptiedTimely', 'yes')">
                                        <span class="yes-option">‚úÖ Yes</span>
                                    </label>
                                    <label class="criteria-option">
                                        <input type="radio" name="${dustbinsKey}-emptied" value="no" 
                                            ${dustbinsData.emptiedTimely === 'no' ? 'checked' : ''}
                                            onchange="updateDustbins('${area.id}', 'emptiedTimely', 'no')">
                                        <span class="no-option">‚ùå No</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="dustbin-criteria">
                                <div class="criteria-title">
                                    üìÖ Last Empty
                                </div>
                                <input type="datetime-local" 
                                    value="${dustbinsData.lastEmptied || ''}"
                                    onchange="updateDustbinsLastEmptied('${area.id}', this.value)">
                            </div>
                        </div>
                        
                        <div style="margin-top: 8px;">
                            <textarea class="dustbins-notes" placeholder="Dustbins notes..."
                                onchange="updateDustbinsNotes('${area.id}', this.value)">${dustbinsData.notes || ''}</textarea>
                        </div>
                    </div>
                `;
            }
            
            // Add regular location cards
            content += area.locations.map(loc => renderLocation(area.id, loc)).join('');
            
            return content;
        }

        function renderLocation(areaId, location) {
            const key = `${areaId}-${location.replace(/\s+/g, '_')}`;
            const d = data[key] || {};
            const diff = d.actualStaff && d.statedStaff ? parseInt(d.actualStaff) - parseInt(d.statedStaff) : '';
            const diffClass = diff < 0 ? 'diff-negative' : diff > 0 ? 'diff-positive' : 'diff-neutral';

            return `
                <div class="location-card">
                    <div class="location-title">${location}</div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Status</label>
                            <select class="status status-${d.status || 'pending'}" 
                                onchange="updateData('${key}', 'status', this.value)">
                                <option value="pending" ${d.status === 'pending' ? 'selected' : ''}>‚è±Ô∏è Pending</option>
                                <option value="excellent" ${d.status === 'excellent' ? 'selected' : ''}>‚úÖ Excellent</option>
                                <option value="good" ${d.status === 'good' ? 'selected' : ''}>üëç Good</option>
                                <option value="fair" ${d.status === 'fair' ? 'selected' : ''}>‚ö†Ô∏è Fair</option>
                                <option value="poor" ${d.status === 'poor' ? 'selected' : ''}>‚ùå Poor</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Score (%)</label>
                            <input type="number" value="${d.score || ''}" min="0" max="100" placeholder="0-100" 
                                onchange="updateData('${key}', 'score', this.value)" />
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" ${d.deepClean ? 'checked' : ''} 
                                onchange="updateData('${key}', 'deepClean', this.checked)" />
                            Deep Clean
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" ${d.routineClean ? 'checked' : ''} 
                                onchange="updateData('${key}', 'routineClean', this.checked)" />
                            Routine Clean
                        </label>
                    </div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Manpower</label>
                            <input type="text" value="${d.manpower || ''}" 
                                onchange="updateData('${key}', 'manpower', this.value)" />
                        </div>
                        <div class="input-group">
                            <label>Material</label>
                            <input type="text" value="${d.material || ''}" 
                                onchange="updateData('${key}', 'material', this.value)" />
                        </div>
                    </div>
                    <div class="grid-3">
                        <div class="input-group">
                            <label>Stated Staff</label>
                            <input type="number" value="${d.statedStaff || ''}" 
                                onchange="updateData('${key}', 'statedStaff', this.value)" />
                        </div>
                        <div class="input-group">
                            <label>Actual Staff</label>
                            <input type="number" value="${d.actualStaff || ''}" 
                                onchange="updateData('${key}', 'actualStaff', this.value)" />
                        </div>
                        <div class="input-group">
                            <label>Difference</label>
                            <div class="diff-display ${diffClass}">
                                ${diff !== '' ? (diff > 0 ? '+' + diff : diff) : '-'}
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Notes</label>
                        <textarea rows="2" placeholder="Add notes..." 
                            onchange="updateData('${key}', 'notes', this.value)">${d.notes || ''}</textarea>
                    </div>
                </div>
            `;
        }

        // ==================== DATA MANAGEMENT ====================
        function updateData(key, field, value) {
            if (!data[key]) data[key] = {};
            data[key][field] = value;
            localStorage.setItem('airportCleanlinessData', JSON.stringify(data));
            updateStats();
        }

        function updateDustbins(areaId, field, value) {
            const key = `${areaId}-dustbins`;
            updateData(key, field, value);
        }

        function updateDustbinsLastEmptied(areaId, value) {
            const key = `${areaId}-dustbins`;
            updateData(key, 'lastEmptied', value);
        }

        function updateDustbinsNotes(areaId, value) {
            const key = `${areaId}-dustbins`;
            updateData(key, 'notes', value);
        }

        // ==================== UI FUNCTIONS ====================
        function toggleSection(id) {
            const content = document.getElementById(`content-${id}`);
            if (!content) return;
            
            const isActive = content.classList.contains('active');
            
            // Close all other sections
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // Toggle current section
            if (!isActive) {
                content.classList.add('active');
            }
        }

        function updateStats() {
            const values = Object.values(data);
            const stats = {
                excellent: values.filter(v => v.status === 'excellent').length,
                good: values.filter(v => v.status === 'good').length,
                fair: values.filter(v => v.status === 'fair').length,
                poor: values.filter(v => v.status === 'poor').length,
                pending: values.filter(v => v.status === 'pending' || !v.status).length
            };
            
            const scores = values.filter(v => v.score !== '' && v.score !== undefined).map(v => parseInt(v.score) || 0);
            const avgScore = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
            
            // Dustbin stats
            const dustbinData = Object.entries(data).filter(([key]) => key.includes('dustbins'));
            const dustbinStats = {
                fullYes: dustbinData.filter(([_, v]) => v.fullOfGarbage === 'yes').length,
                cleanedYes: dustbinData.filter(([_, v]) => v.cleaned === 'yes').length,
                emptiedYes: dustbinData.filter(([_, v]) => v.emptiedTimely === 'yes').length
            };

            const statsContainer = document.getElementById('stats');
            if (!statsContainer) return;
            
            statsContainer.innerHTML = `
                <div class="stat-card excellent">
                    <div class="stat-label">Excellent</div>
                    <div class="stat-value">${stats.excellent}</div>
                </div>
                <div class="stat-card good">
                    <div class="stat-label">Good</div>
                    <div class="stat-value">${stats.good}</div>
                </div>
                <div class="stat-card fair">
                    <div class="stat-label">Fair</div>
                    <div class="stat-value">${stats.fair}</div>
                </div>
                <div class="stat-card poor">
                    <div class="stat-label">Poor</div>
                    <div class="stat-value">${stats.poor}</div>
                </div>
                <div class="stat-card pending">
                    <div class="stat-label">Pending</div>
                    <div class="stat-value">${stats.pending}</div>
                </div>
                <div class="stat-card avg">
                    <div class="stat-label">Avg Score</div>
                    <div class="stat-value">${avgScore}%</div>
                </div>
                <div class="stat-card ${dustbinStats.fullYes === 0 ? 'good' : 'poor'}">
                    <div class="stat-label">Full Bins</div>
                    <div class="stat-value">${dustbinStats.fullYes}</div>
                </div>
                <div class="stat-card ${dustbinStats.cleanedYes > 0 ? 'good' : 'fair'}">
                    <div class="stat-label">Clean Bins</div>
                    <div class="stat-value">${dustbinStats.cleanedYes}</div>
                </div>
                <div class="stat-card ${dustbinStats.emptiedYes > 0 ? 'good' : 'fair'}">
                    <div class="stat-label">On Time</div>
                    <div class="stat-value">${dustbinStats.emptiedYes}</div>
                </div>
            `;
        }

        // ==================== EXPORT FUNCTIONS ====================
        function exportCSV() {
            let csv = 'Date,Shift,Time,Inspector,Area,Location,Status,Score,Deep Clean,Routine Clean,Manpower,Material,Stated Staff,Actual Staff,Difference,Notes\n';
            const date = document.getElementById('date')?.value || '';
            const shift = document.getElementById('shift')?.value || '';
            const time = document.getElementById('time')?.value || '';
            const inspector = document.getElementById('inspector')?.value || '';

            areas.forEach(area => {
                // Export locations
                area.locations.forEach(loc => {
                    const key = `${area.id}-${loc.replace(/\s+/g, '_')}`;
                    const d = data[key] || {};
                    const diff = d.actualStaff && d.statedStaff ? parseInt(d.actualStaff) - parseInt(d.statedStaff) : '';
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","${loc}","${d.status || ''}","${d.score || ''}","${d.deepClean || false}","${d.routineClean || false}","${d.manpower || ''}","${d.material || ''}","${d.statedStaff || ''}","${d.actualStaff || ''}","${diff}","${d.notes || ''}"\n`;
                });
                
                // Export dustbins data
                if (area.hasDustbins) {
                    const dustbinsKey = `${area.id}-dustbins`;
                    const dustbinsData = data[dustbinsKey] || {};
                    csv += `"${date}","${shift}","${time}","${inspector}","${area.name}","Dustbins","","","","","","","","","","Full: ${dustbinsData.fullOfGarbage || ''}, Cleaned: ${dustbinsData.cleaned || ''}, Emptied: ${dustbinsData.emptiedTimely || ''}, Last: ${dustbinsData.lastEmptied || ''}, Notes: ${dustbinsData.notes || ''}"\n`;
                }
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `airport-cleanliness-${date || 'report'}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function resetAll() {
            if (confirm('Reset all data? This cannot be undone.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // ==================== INITIALIZE APP ====================
        // Wait for DOM to be fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
        // Mobile viewport fix
        window.addEventListener('resize', function() {
            document.body.style.width = '100%';
        });
    </script>
</body>
</html>